/**
 * @file Módulo responsável por injetar o HTML principal e os modais no DOM.
 * ATUALIZADO COM CLASSES RESPONSIVAS (sm:, md:, lg:)
 */
const mainHTML = `
  <div id="loading-overlay" class="fixed inset-0 bg-bkg bg-opacity-75 flex items-center justify-center z-[200]">
    <div class="w-16 h-16 border-4 border-primary border-t-transparent rounded-full animate-spin"></div>
  </div>

  <div id="auth-screen">
    <div class="min-h-screen flex flex-col items-center justify-center bg-bkg p-4"><div class="w-full max-w-md p-6 sm:p-8 space-y-6 bg-surface rounded-xl shadow-2xl border border-border"><div><h2 id="auth-title" class="text-center text-3xl font-extrabold text-secondary">Acesse sua Conta</h2><p id="auth-prompt" class="mt-2 text-center text-sm text-subtle"></p></div><form id="auth-form" class="space-y-6"><input type="email" id="auth-email" placeholder="Email" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md shadow-sm"><div class="relative"><input type="password" id="auth-password" placeholder="Senha" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md shadow-sm pr-12 appearance-none"><button type="button" id="toggle-password-btn" data-toggle-password class="absolute inset-y-0 right-0 px-4 flex items-center text-subtle hover:text-primary"><svg class="w-5 h-5 eye-icon" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M2.036 12.322a1.012 1.012 0 010-.639C3.423 7.51 7.36 4.5 12 4.5c4.638 0 8.573 3.007 9.963 7.178.07.207.07.431 0 .639C20.577 16.49 16.64 19.5 12 19.5c-4.638 0-8.573-3.007-9.963-7.178z" /><path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z" /></svg><svg class="w-5 h-5 eye-slash-icon hidden" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path d="M3.98 8.223A10.477 10.477 0 001.934 12C3.226 16.338 7.244 19.5 12 19.5c.993 0 1.953-.138 2.863-.395M6.228 6.228A10.45 10.45 0 0112 4.5c4.756 0 8.773 3.162 10.065 7.498a10.523 10.523 0 01-4.293 5.774M6.228 6.228L3 3m3.228 3.228l3.65 3.65m7.894 7.894L21 21m-3.228-3.228l-3.65-3.65m0 0a3 3 0 10-4.243-4.243m4.243 4.243L6.228 6.228" /></svg></button></div><button id="auth-submit-btn" type="submit" class="w-full flex justify-center py-3 px-4 rounded-md shadow-sm text-sm font-bold text-bkg bg-primary hover:opacity-90">Entrar</button></form></div></div>
  </div>

  <div id="app-container" class="hidden flex flex-col min-h-screen">
    <div id="notification-container" class="fixed top-5 right-5 z-[100] w-full max-w-sm space-y-2 px-4 sm:px-0"></div>
    <header class="bg-surface shadow-md border-b border-border sticky top-0 z-40 flex-shrink-0">
      <div class="container mx-auto px-4 sm:px-6 lg:px-8">
        <div class="flex items-center justify-between h-16">
          <h1 class="text-xl sm:text-2xl font-bold text-secondary truncate">Meu Planner</h1>
          <div class="flex items-center">
            <button id="theme-toggle-btn" class="p-2 rounded-full text-subtle hover:text-secondary hover:bg-surface mr-2 sm:mr-4">
              <svg id="theme-sun-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z"></path></svg>
              <svg id="theme-moon-icon" class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M20.354 15.354A9 9 0 018.646 3.646 9.003 9.003 0 0012 21a9.003 9.003 0 008.354-5.646z"></path></svg>
            </button>
            <div class="relative">
              <button id="notification-bell-btn" class="p-2 rounded-full text-subtle hover:text-secondary hover:bg-surface mr-2 sm:mr-4">
                <span id="notification-badge" class="hidden absolute top-1 right-1 block h-2 w-2 rounded-full bg-danger ring-2 ring-surface"></span>
                <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6 6 0 10-12 0v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"></path></svg>
              </button>
              <div id="notification-panel" class="hidden absolute right-0 mt-2 w-72 md:w-80 bg-surface rounded-md shadow-lg z-50 border border-border">
                <div class="p-3 border-b border-border"><h4 class="font-semibold text-secondary">Notificações</h4></div>
                <div id="notification-list" class="max-h-80 overflow-y-auto"></div>
              </div>
            </div>
            <span id="user-email" class="hidden sm:block text-sm text-subtle mx-4 truncate max-w-[150px]"></span>
            <button id="logout-btn" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg shadow-md hover:opacity-90 text-sm">Sair</button>
          </div>
        </div>
      </div>
    </header>
    
    <main class="container mx-auto py-6 px-4 sm:px-6 lg:px-8 flex flex-col flex-grow">
      
      <div id="enrollments-view" class="hidden">
        <div class="py-6 sm:px-0">
            <div class="flex flex-col sm:flex-row justify-between items-stretch sm:items-center mb-6 gap-4">
                <h2 class="text-3xl font-bold text-secondary">Minhas Matrículas</h2>
                <div class="flex items-center gap-2 sm:gap-4 flex-shrink-0">
                    <button data-action="view-documents" class="w-full sm:w-auto bg-primary/10 text-primary font-bold py-2 px-4 rounded-lg shadow-md hover:bg-primary/20">Documentos</button>
                    <button id="add-enrollment-btn" class="w-full sm:w-auto bg-primary text-bkg font-semibold py-2 px-4 rounded-lg shadow-md hover:opacity-90">+ Adicionar</button>
                </div>
            </div>
            <div id="enrollments-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6"></div>
        </div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-8">
            <div>
              <h3 class="text-2xl font-bold text-secondary mb-4">Sessões de Estudo</h3>
              <div id="pomodoro-timer-container" class="bg-surface p-6 rounded-xl shadow-lg border border-border h-80 flex flex-col justify-between items-center">
                  <div class="w-full flex justify-between items-center">
                      <div class="flex items-center gap-2">
                        <h4 class="font-bold text-secondary text-lg">Pomodoro</h4>
                        <button id="main-pomodoro-mute-btn" class="hidden text-subtle p-1 rounded-full hover:bg-bkg" data-action="toggle-mute">
                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 pointer-events-none"><path d="M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318.664-2.66 1.905A9.76 9.76 0 001.5 12c0 .898.121 1.768.35 2.595.341 1.24 1.518 1.905 2.66 1.905H6.44l4.5 4.5c.944.945 2.56.276 2.56-1.06V4.06zM18.584 5.106a.75.75 0 011.06 0c3.808 3.807 3.808 9.98 0 13.788a.75.75 0 11-1.06-1.06 8.25 8.25 0 000-11.668.75.75 0 010-1.06z" /><path d="M15.932 7.757a.75.75 0 011.061 0 6 6 0 010 8.486.75.75 0 01-1.06-1.061 4.5 4.5 0 000-6.364.75.75 0 010-1.06z" /></svg>
                        </button>
                      </div>
                      <button data-action="view-study-history" class="text-sm font-semibold bg-primary/10 text-primary px-3 py-1 rounded-md hover:bg-primary/20 flex items-center gap-2">
                          <svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
                          Histórico
                      </button>
                  </div>
                  <div id="pomodoro-display-container" class="text-center">
                      <div id="pomodoro-status" class="text-lg font-semibold text-subtle mb-2">Pronto para focar?</div>
                      <div id="pomodoro-display" class="text-6xl sm:text-7xl font-bold text-primary">25:00</div>
                  </div>
                  <div id="pomodoro-controls" class="w-full flex items-center justify-center gap-4">
                      <button id="start-pomodoro-btn" class="bg-green-500 text-white font-semibold p-4 rounded-full hover:bg-green-600">
                          <svg class="w-8 h-8 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"></path></svg>
                      </button>
                      <button id="pause-pomodoro-btn" class="hidden bg-yellow-500 text-white font-semibold p-4 rounded-full hover:bg-yellow-600">
                          <svg class="w-8 h-8 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M5.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75A.75.75 0 007.25 3h-1.5zM12.75 3a.75.75 0 00-.75.75v12.5c0 .414.336.75.75.75h1.5a.75.75 0 00.75-.75V3.75a.75.75 0 00-.75-.75h-1.5z"></path></svg>
                      </button>
                      <button id="stop-pomodoro-btn" class="hidden bg-danger text-white font-semibold p-4 rounded-full hover:opacity-90">
                          <svg class="w-8 h-8 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M5.5 5.5A.5.5 0 016 5h8a.5.5 0 01.5.5v8a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5v-8z"></path></svg>
                      </button>
                  </div>
              </div>
            </div>
            <div>
                <h3 class="text-2xl font-bold text-secondary mb-4">Tarefas do Dia</h3>
                <div id="todo-list-container" class="bg-surface p-4 rounded-xl shadow-lg border border-border h-80 flex flex-col">
                    <div id="todo-items-list" class="space-y-2 mb-4 flex-grow overflow-y-auto custom-scrollbar pr-2"></div>
                    <form id="add-todo-form" class="flex items-center gap-2 mt-auto">
                        <input type="text" id="new-todo-input" placeholder="Nova tarefa..." required class="flex-grow px-3 py-2 bg-bkg text-secondary border border-border rounded-md">
                        <button type="submit" class="p-2 bg-primary rounded-md text-bkg hover:opacity-90 flex-shrink-0">
                            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>
                        </button>
                    </form>
                </div>
            </div>
            <div>
              <h3 class="text-2xl font-bold text-secondary mb-4">Próximos Eventos</h3>
              <div class="bg-surface p-4 rounded-xl shadow-lg border border-border h-80 flex flex-col">
                <div id="upcoming-events-list" class="flex-grow overflow-y-auto custom-scrollbar pr-2 space-y-3">
                    <p class="text-subtle text-center pt-4">Nenhum evento futuro.</p>
                </div>
              </div>
            </div>
        </div>
      </div>
      
      <div id="dashboard-view" class="hidden">
        <div class="dashboard-header"><button id="back-to-enrollments-btn" class="back-button"><svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" /></svg></button><div><h2 id="dashboard-title" class="text-2xl md:text-3xl font-bold text-secondary"></h2><p id="dashboard-subtitle" class="text-subtle"></p></div></div>
        <div class="flex flex-col md:flex-row items-stretch md:items-center justify-end mb-6 gap-2 flex-wrap"><div class="flex flex-col sm:flex-row gap-2 flex-wrap"><button data-action="view-documents" class="bg-primary/10 text-primary font-bold py-2 px-4 rounded-lg shadow-md hover:bg-primary/20">Documentos</button><button data-action="view-checklist" class="bg-primary/10 text-primary font-bold py-2 px-4 rounded-lg shadow-md hover:bg-primary/20">Ver Grade</button><button data-action="view-grades-report" class="bg-primary/10 text-primary font-bold py-2 px-4 rounded-lg shadow-md hover:bg-primary/20">Ver Boletim</button></div><div class="flex items-center bg-surface rounded-lg shadow-sm border border-border"><button id="prev-period-btn" class="p-2 rounded-md hover:bg-bkg disabled:opacity-25 disabled:cursor-not-allowed"><svg class="w-5 h-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M15 19l-7-7 7-7"></path></svg></button><span id="current-period-name" class="font-bold text-secondary px-4 text-center w-28"></span><button id="next-period-btn" class="p-2 rounded-md hover:bg-bkg disabled:opacity-25 disabled:cursor-not-allowed"><svg class="w-5 h-5 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M9 5l7 7-7 7"></path></svg></button></div><div class="flex gap-2"><button id="new-period-btn" class="flex-1 bg-primary text-bkg font-bold py-2 px-4 rounded-lg shadow-md hover:opacity-90">Novo Período</button><button id="manage-period-btn" class="p-2 rounded-lg hover:bg-surface" title="Opções"><svg class="w-6 h-6 text-subtle pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path></svg></button></div></div>
        <div id="summary-cards-container" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4 mb-8"></div>
        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
          <div class="lg:col-span-2">
            <div class="flex justify-between items-center mb-4">
              <h3 class="text-2xl font-bold text-secondary">Disciplinas</h3>
              <button id="add-discipline-btn" class="bg-primary text-bkg font-bold py-2 px-4 rounded-lg shadow-md hover:opacity-90">Adicionar</button>
            </div>
            <div id="disciplines-list" class="space-y-4"></div>
          </div>
          <div class="lg:col-span-1 flex flex-col gap-8">
            <div>
              <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-4">
                <div class="flex items-center gap-2">
                  <h3 class="text-2xl font-bold text-secondary">Agenda</h3>
                  <div id="agenda-view-toggle" class="flex items-center bg-bkg p-1 rounded-lg border border-border">
                    <button data-view="classes" class="agenda-view-btn active px-3 py-1 text-sm font-semibold rounded-md">Aulas</button>
                    <button data-view="events" class="agenda-view-btn px-3 py-1 text-sm font-semibold rounded-md">Eventos</button>
                  </div>
                </div>
              </div>
              <div id="agenda-content-container" class="space-y-4"></div>
            </div>
            <div>
              <div class="flex justify-between items-center mb-4">
                <h3 class="text-2xl font-bold text-secondary">Calendário</h3>
                <div class="flex items-center gap-2">
                  <button data-action="expand-calendar" class="text-sm font-semibold bg-primary/10 text-primary px-3 py-1 rounded-md hover:bg-primary/20">Expandir</button>
                  <button data-action="add-new-event" class="text-sm font-semibold bg-primary/10 text-primary px-3 py-1 rounded-md hover:bg-primary/20">+ Novo Evento</button>
                </div>
              </div>
              <div id="calendar-container" class="bg-surface p-2 sm:p-4 rounded-xl shadow-lg border border-border"></div>
            </div>
          </div>
        </div>
      </div>

      <div id="calendar-view" class="hidden flex-grow flex flex-col">
        <div class="dashboard-header flex-shrink-0">
          <button data-action="back-to-dashboard-from-calendar" class="back-button">
            <svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          </button>
          <div>
            <h2 id="calendar-view-title" class="text-2xl md:text-3xl font-bold text-secondary">Calendário Acadêmico</h2>
            <p id="calendar-view-subtitle" class="text-subtle"></p>
          </div>
        </div>

        <div class="flex-grow grid grid-cols-1 lg:grid-cols-5 gap-6 mt-4">
          
          <div id="full-calendar-container" class="lg:col-span-3 bg-surface p-4 rounded-xl shadow-lg border border-border">
            </div>
          
          <div class="lg:col-span-2 flex flex-col gap-6">
            
            <div class="bg-surface p-4 rounded-xl shadow-lg border border-border flex-shrink-0">
                <h3 class="text-xl font-bold text-secondary mb-4">Filtros</h3>
                <div id="calendar-filters-container" class="space-y-4"></div>
            </div>

            <div class="bg-surface p-4 rounded-xl shadow-lg border border-border flex flex-col flex-grow min-h-0">
                <h3 class="text-xl font-bold text-secondary mb-2 flex-shrink-0">Eventos na Tela</h3>
                <div id="calendar-legend-container" class="flex-grow overflow-y-auto custom-scrollbar -mr-2 pr-2">
                    </div>
            </div>

            </div>

        </div>
        </div>

      <div id="discipline-dashboard-view" class="hidden flex-grow flex flex-col">
        <div class="dashboard-header flex-shrink-0">
          <button data-action="back-to-dashboard" class="back-button">
            <svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg>
          </button>
          <div>
            <h2 id="discipline-dash-title" class="text-2xl md:text-3xl font-bold text-secondary"></h2>
            <p id="discipline-dash-subtitle" class="text-subtle"></p>
          </div>
        </div>
        
        <div class="flex-grow overflow-y-auto custom-scrollbar pr-2 mt-2">
            <div id="discipline-stats-container" class="grid grid-cols-1 sm:grid-cols-3 gap-6 mb-8"></div>
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                <section class="ui-card lg:col-span-2"><div class="flex justify-between items-center mb-4"><h3 class="card-header">Avaliações</h3><button data-action="manage-evaluations" class="text-sm font-semibold text-link">Gerenciar</button></div><div id="evaluations-list" class="grid grid-cols-[repeat(auto-fit,minmax(96px,1fr))] gap-4"></div></section>
                <section id="absences-section" class="ui-card lg:col-span-1"></section>
                <section id="performance-section" class="ui-card lg:col-span-2"><h3 class="card-header mb-4">Desempenho nas Avaliações</h3><div class="h-64" id="discipline-performance-chart-container"><canvas id="discipline-performance-chart"></canvas></div></section>
                <section id="events-section" class="ui-card lg:col-span-1"><div class="flex justify-between items-center mb-4"><h3 class="card-header">Próximos Eventos</h3><button data-action="add-new-event" class="text-sm font-semibold text-link">+ Novo Evento</button></div><div id="discipline-events-list" class="space-y-3"></div></section>
            </div>
        </div>
      </div>
      
      <div id="grades-report-view" class="hidden flex flex-col flex-grow">
        <div class="dashboard-header flex-shrink-0"><button data-action="back-to-dashboard" class="back-button"><svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div><h2 id="grades-report-title" class="text-2xl md:text-3xl font-bold text-secondary">Boletim Acadêmico</h2><p id="grades-report-subtitle" class="text-subtle"></p></div></div>
        <div class="flex items-center justify-end mb-6 flex-shrink-0"><button id="export-pdf-btn" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg shadow-md hover:opacity-90 flex items-center gap-2"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4" /></svg>Exportar PDF</button></div>
        <div id="grades-report-content" class="flex-grow overflow-y-auto custom-scrollbar pr-2"></div>
      </div>

      <div id="course-checklist-view" class="hidden flex flex-col flex-grow">
        <div class="dashboard-header flex-shrink-0"><button data-action="back-to-dashboard" class="back-button"><svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div><h2 id="checklist-title" class="text-2xl md:text-3xl font-bold text-secondary">Grade Curricular</h2><p id="checklist-subtitle" class="text-subtle"></p></div></div>
        <div class="flex items-center justify-end mb-6 flex-shrink-0"><button id="add-curriculum-subject-btn" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg shadow-md hover:opacity-90 flex items-center gap-2"><svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>Adicionar Disciplina</button></div>
        <div id="checklist-content" class="flex-grow overflow-y-auto custom-scrollbar pr-2"></div>
      </div>
      
      <div id="documents-view" class="hidden flex flex-col flex-grow">
        <div class="dashboard-header flex-shrink-0"><button data-action="back-from-documents" class="back-button"><svg class="w-6 h-6 pointer-events-none" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path></svg></button><div><h2 id="documents-title" class="text-2xl md:text-3xl font-bold text-secondary">Meus Documentos</h2><p id="documents-subtitle" class="text-subtle"></p></div></div>
        <div id="documents-toolbar" class="mb-6 p-4 bg-surface rounded-xl border border-border flex flex-col md:flex-row items-center gap-4 flex-shrink-0">
          <div class="relative w-full md:flex-grow"><svg class="w-5 h-5 text-subtle absolute left-3 top-1/2 -translate-y-1/2" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg><input type="search" id="document-search-input" placeholder="Pesquisar..." class="w-full pl-10 pr-4 py-2 bg-bkg text-secondary border border-border rounded-md"></div>
          <div class="flex flex-col sm:flex-row items-center gap-4 w-full md:w-auto">
            <div class="relative w-full sm:w-48" data-dropdown-container data-filter-key="type"><input type="hidden" class="filter-value" value="all"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button w-full"><span class="selected-value truncate">Todos os Tipos</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" /></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="all" class="selected">Todos os Tipos</li><li data-action="select-dropdown-item" data-value="Certificado">Certificado</li><li data-action="select-dropdown-item" data-value="Comprovante">Comprovante</li><li data-action="select-dropdown-item" data-value="Material de Estudo">Material de Estudo</li><li data-action="select-dropdown-item" data-value="Slide de Aula">Slide de Aula</li><li data-action="select-dropdown-item" data-value="Trabalho Acadêmico">Trabalho Acadêmico</li><li data-action="select-dropdown-item" data-value="Outro">Outro</li></ul></div></div>
            <div class="relative w-full sm:w-48" data-dropdown-container data-filter-key="sort"><input type="hidden" class="filter-value" value="createdAt_desc"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button w-full"><span class="selected-value truncate">Mais Recentes</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" /></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="createdAt_desc" class="selected">Mais Recentes</li><li data-action="select-dropdown-item" data-value="createdAt_asc">Mais Antigos</li><li data-action="select-dropdown-item" data-value="title_asc">Título (A-Z)</li></ul></div></div>
          </div>
          <button id="add-document-btn" class="w-full md:w-auto bg-primary text-bkg font-semibold py-2 px-4 rounded-lg shadow-md hover:opacity-90 flex-shrink-0">+ Adicionar</button>
        </div>
        
        <div id="documents-content-wrapper" class="flex flex-col flex-grow"><div id="documents-list" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6"></div><div id="documents-empty-state" class="hidden text-center m-auto"><div id="documents-empty-state-icon"></div><h3 id="documents-empty-state-title" class="mt-4 text-xl font-bold text-secondary"></h3><p id="documents-empty-state-subtitle" class="mt-1 text-sm text-subtle"></p></div></div>
      </div>

    </main>

    <div id="floating-pomodoro-timer" class="hidden fixed bottom-5 right-5 bg-surface p-4 rounded-lg shadow-2xl border border-border cursor-grab z-50 flex items-center gap-4">
      <div class="text-center"><div id="floating-timer-display" class="text-2xl font-bold text-primary">25:00</div><div id="floating-timer-status" class="text-xs font-semibold text-subtle">Foco</div></div>
      <div class="flex items-center gap-2">
        <button id="floating-pause-pomodoro-btn" class="p-2 rounded-full hover:bg-bkg text-secondary"></button>
        <button id="floating-stop-pomodoro-btn" class="p-2 rounded-full hover:bg-bkg text-danger" title="Parar"><svg class="w-5 h-5 pointer-events-none" fill="currentColor" viewBox="0 0 20 20"><path d="M5.5 5.5A.5.5 0 016 5h8a.5.5 0 01.5.5v8a.5.5 0 01-.5.5H6a.5.5 0 01-.5-.5v-8z"></path></svg></button>
        <button data-action="toggle-mute" class="p-2 rounded-full hover:bg-bkg text-subtle" title="Mudo"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-4 h-4 pointer-events-none"><path d="M13.5 4.06c0-1.336-1.616-2.005-2.56-1.06l-4.5 4.5H4.508c-1.141 0-2.318.664-2.66 1.905A9.76 9.76 0 001.5 12c0 .898.121 1.768.35 2.595.341 1.24 1.518 1.905 2.66 1.905H6.44l4.5 4.5c.944.945 2.56.276 2.56-1.06V4.06zM18.584 5.106a.75.75 0 011.06 0c3.808 3.807 3.808 9.98 0 13.788a.75.75 0 11-1.06-1.06 8.25 8.25 0 000-11.668.75.75 0 010-1.06z" /><path d="M15.932 7.757a.75.75 0 011.061 0 6 6 0 010 8.486.75.75 0 01-1.06-1.061 4.5 4.5 0 000-6.364.75.75 0 010-1.06z" /></svg></button>
      </div>
    </div>
  </div>
`;

const modalHTML = `
  <div id="add-enrollment-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md border border-border"><h3 id="enrollment-modal-title" class="text-2xl font-bold mb-6 text-secondary">Nova Matrícula</h3><form id="add-enrollment-form"><div class="space-y-4"><input type="text" id="enrollment-course" placeholder="Nome do Curso" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"><input type="text" id="enrollment-institution" placeholder="Instituição de Ensino" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"><div><label class="block text-sm font-medium text-subtle mb-2">Modalidade</label><div class="flex items-center gap-6" role="radiogroup" id="enrollment-modality-group"><div class="flex items-center"><input type="radio" id="modality-presencial" name="enrollment-modality" value="Presencial" checked class="h-4 w-4 text-primary border-subtle focus:ring-primary"><label for="modality-presencial" class="ml-2 block text-sm text-secondary">Presencial</label></div><div class="flex items-center"><input type="radio" id="modality-ead" name="enrollment-modality" value="EAD" class="h-4 w-4 text-primary border-subtle focus:ring-primary"><label for="modality-ead" class="ml-2 block text-sm text-secondary">EAD</label></div></div></div><div><input type="number" step="0.1" id="enrollment-passing-grade" placeholder="Média para Aprovação" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-enrollment-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
  <div id="add-period-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md border border-border"><h3 class="text-2xl font-bold mb-6 text-secondary">Novo Período Letivo</h3><form id="add-period-form" class="space-y-4"><div><label for="period-name" class="block text-sm font-medium text-subtle mb-1">Nome</label><input type="text" id="period-name" placeholder="Ex: 2025.2" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="period-start-date-new" class="block text-sm font-medium text-subtle mb-1">Início</label><input type="date" id="period-start-date-new" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="period-end-date-new" class="block text-sm font-medium text-subtle mb-1">Fim</label><input type="date" id="period-end-date-new" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-period-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Criar</button></div></form></div></div>
  <div id="add-discipline-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-xl border border-border"><h3 id="discipline-modal-title" class="text-2xl font-bold mb-6 text-secondary">Nova Disciplina</h3><form id="add-discipline-form"><div class="grid grid-cols-1 md:grid-cols-2 gap-x-6 gap-y-4"><div class="md:col-span-2"><label for="discipline-name" class="block text-sm font-medium text-subtle mb-1">Nome*</label><input type="text" id="discipline-name" placeholder="Ex: Cálculo I" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="discipline-code" class="block text-sm font-medium text-subtle mb-1">Código</label><input type="text" id="discipline-code" placeholder="Opcional" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="discipline-teacher" class="block text-sm font-medium text-subtle mb-1">Professor(a)</label><input type="text" id="discipline-teacher" placeholder="Opcional" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="discipline-campus" class="block text-sm font-medium text-subtle mb-1">Campus</label><input type="text" id="discipline-campus" placeholder="Ex: Gragoatá" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="discipline-location" class="block text-sm font-medium text-subtle mb-1">Local/Sala</label><input type="text" id="discipline-location" placeholder="Ex: Sala 203" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="md:col-span-2"><label class="block text-sm font-medium text-subtle mb-1">Cor</label><div id="discipline-color-palette" class="flex flex-wrap justify-center gap-3 p-2 bg-bkg rounded-md border border-border"></div><input type="hidden" id="discipline-color-input"></div><div class="md:col-span-2"><label class="block text-sm font-medium text-subtle mb-1">Horários</label><div id="schedules-container" class="space-y-2"></div><button type="button" id="add-schedule-btn" class="mt-2 text-sm text-primary hover:opacity-80 flex items-center"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>Adicionar</button></div>
  <div id="absence-control-section" class="contents"><div class="md:col-span-2 pt-2"><p class="text-sm font-medium text-subtle">Controle de Faltas</p><small class="text-xs text-subtle/70">Usado para calcular o limite de faltas.</small></div><div><label for="discipline-workload" class="block text-sm font-medium text-subtle mb-1">Carga Horária (h)*</label><input type="number" id="discipline-workload" min="1" placeholder="Ex: 60" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="discipline-hours-per-class" class="block text-sm font-medium text-subtle mb-1">Horas por Aula*</label><input type="number" id="discipline-hours-per-class" min="1" placeholder="Ex: 2" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div></div>
  <div id="discipline-notes-section" class="hidden md:col-span-2"><label for="discipline-notes" class="block text-sm font-medium text-subtle mb-1">Observações</label><textarea id="discipline-notes" rows="3" placeholder="Ex: Encontros síncronos às terças, 19h" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></textarea><small class="text-xs text-subtle/70">Este texto aparecerá no lugar do horário no card da disciplina.</small></div>
  </div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-discipline-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
  <div id="config-grades-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><h3 id="config-grades-title" class="text-2xl font-bold mb-6 text-secondary">Avaliações</h3><form id="config-grades-form" class="space-y-4"><div><label for="grade-calculation-rule" class="block text-sm font-medium text-subtle mb-1">Tipo de Média</label><div class="relative" data-dropdown-container><input type="hidden" id="grade-calculation-rule" value="weighted"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Média Ponderada</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="weighted" class="selected">Média Ponderada</li><li data-action="select-dropdown-item" data-value="arithmetic">Média Aritmética</li></ul></div></div></div><div id="grades-container" class="space-y-3"></div><div id="grades-summary" class="text-right"></div><button type="button" id="add-grade-field-btn" class="text-sm text-primary hover:opacity-80 flex items-center"><svg class="w-4 h-4 mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M12 6v6m0 0v6m0-6h6m-6 0H6"/></svg>Adicionar</button><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-config-grades-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
  <div id="add-absence-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md border border-border"><h3 class="text-2xl font-bold mb-6 text-secondary">Registrar Falta</h3><form id="add-absence-form"><div class="space-y-4"><div><label for="absence-date" class="block text-sm font-medium text-subtle mb-1">Data</label><input type="date" id="absence-date" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="absence-justification" class="block text-sm font-medium text-subtle mb-1">Justificativa</label><textarea id="absence-justification" placeholder="Opcional" rows="3" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></textarea></div></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-absence-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
  <div id="absence-history-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border flex flex-col max-h-[80vh]"><h3 id="absence-history-title" class="text-2xl font-bold mb-4 text-secondary flex-shrink-0">Histórico de Faltas</h3><div id="absence-history-list" class="flex-grow overflow-y-auto custom-scrollbar pr-2"></div><button type="button" id="close-absence-history-btn" class="mt-6 w-full bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80 flex-shrink-0">Fechar</button></div></div>
  <div id="confirm-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-60 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-sm border border-border"><h3 id="confirm-modal-title" class="text-xl font-bold text-secondary"></h3><p id="confirm-modal-message" class="text-subtle mt-2"></p><div class="mt-6 flex justify-end space-x-4"><button id="confirm-modal-cancel-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button id="confirm-modal-confirm-btn" class="font-semibold py-2 px-4 rounded-lg text-white"></button></div></div></div>
  <div id="period-options-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><div><h3 class="text-2xl font-bold text-secondary">Gerenciar Período</h3><p id="period-options-subtitle" class="text-subtle"></p></div><form id="period-options-form" class="mt-6"><div class="space-y-4"><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="period-start-date" class="block text-sm font-medium text-subtle mb-1">Início</label><input type="date" id="period-start-date" class="w-full px-3 py-2 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="period-end-date" class="block text-sm font-medium text-subtle mb-1">Fim</label><input type="date" id="period-end-date" class="w-full px-3 py-2 bg-bkg text-secondary border border-border rounded-md"></div></div><div><label class="block text-sm font-medium text-subtle mb-1">Calendário Acadêmico</label><input type="file" id="period-calendar-file" accept=".pdf,.jpg,.jpeg,.png" class="hidden"><div id="calendar-upload-view"><label for="period-calendar-file" class="w-full cursor-pointer text-center px-4 py-2 text-sm rounded-md border border-dashed border-border hover:bg-bkg flex items-center justify-center gap-2"><svg class="w-4 h-4 text-subtle" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12" /></svg> Anexar arquivo</label></div><div id="calendar-uploaded-view" class="hidden flex items-center justify-between p-2 bg-bkg rounded-md border border-border"><span id="calendar-file-name" class="text-sm text-secondary truncate ml-2"></span><div><a href="#" target="_blank" id="view-calendar-link" class="text-sm text-primary hover:underline px-2">Ver</a><button type="button" id="remove-calendar-btn" class="text-sm text-danger hover:underline px-2">Remover</button></div></div></div></div></form><div class="mt-6 pt-4 border-t border-border"><div class="p-4 rounded-lg border border-danger/50 bg-danger/10"><div class="flex items-start"><div class="flex-shrink-0"><h3 class="text-sm font-bold text-danger">⚠️</h3></div><div class="ml-3"><h3 class="text-sm font-bold text-danger">Zona de Perigo</h3><div class="mt-2 text-sm text-danger/80"><p>As ações abaixo são permanentes. Tenha cuidado.</p></div><div class="mt-4 flex space-x-4"><button type="button" id="end-period-btn" class="flex-1 justify-center text-center px-3 py-2 text-sm font-semibold text-warning bg-transparent border border-warning rounded-md hover:bg-warning/10">Encerrar Período</button><button type="button" id="delete-period-btn" class="flex-1 justify-center text-center px-3 py-2 text-sm font-semibold text-danger bg-transparent border border-danger rounded-md hover:bg-danger/10">Deletar Período</button></div></div></div></div><button type="button" id="reopen-period-btn" class="hidden w-full mt-4 text-center px-3 py-2 text-sm font-semibold text-secondary border border-border rounded-md hover:bg-bkg">Reabrir Período</button></div><div class="mt-8 flex justify-end space-x-4"><button type="button" data-action="cancel" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" form="period-options-form" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar Alterações</button></div></div></div>
  <div id="pdf-viewer-modal" class="hidden fixed inset-0 bg-black bg-opacity-85 flex items-center justify-center z-50 p-4"><div class="bg-surface w-full h-full max-w-4xl max-h-[90vh] rounded-lg shadow-xl flex flex-col border border-border"><div class="flex justify-between items-center p-4 border-b border-border"><h3 class="text-xl font-bold text-secondary">Calendário</h3><button id="close-pdf-viewer-btn" class="p-2 rounded-full hover:bg-bkg"><svg class="w-6 h-6 text-subtle" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path d="M6 18L18 6M6 6l12 12" /></svg></button></div><div class="flex-grow p-2"><iframe id="pdf-viewer-iframe" class="w-full h-full border-0" src=""></iframe></div></div></div>
  <div id="add-event-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><h3 id="event-modal-title" class="text-2xl font-bold mb-6 text-secondary">Novo Evento</h3><form id="add-event-form" class="space-y-4"><input type="hidden" id="event-id"><div><label for="event-title" class="block text-sm font-medium text-subtle mb-1">Título do Evento*</label><input type="text" id="event-title" placeholder="Ex: Entrega de TCC" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label for="event-date" class="block text-sm font-medium text-subtle mb-1">Data*</label><input type="date" id="event-date" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="event-category-value" class="block text-sm font-medium text-subtle mb-1">Categoria</label><div class="relative" data-dropdown-container><input type="hidden" id="event-category-value" value="Prova"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Prova</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="event-category-list" class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="Prova" class="selected">Prova</li><li data-action="select-dropdown-item" data-value="Trabalho">Trabalho</li><li data-action="select-dropdown-item" data-value="Apresentação">Apresentação</li><li data-action="select-dropdown-item" data-value="Feriado">Feriado</li><li data-action="select-dropdown-item" data-value="Vista de Prova">Vista de Prova</li><li data-action="select-dropdown-item" data-value="Semana Acadêmica">Semana Acadêmica</li><li data-action="select-dropdown-item" data-value="Outro">Outro</li></ul></div></div></div></div><div><label for="event-discipline-value" class="block text-sm font-medium text-subtle mb-1">Matéria Relacionada</label><div class="relative" data-dropdown-container><input type="hidden" id="event-discipline-value" value="none"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Nenhuma</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="event-discipline-list" class="custom-dropdown-list"></ul></div></div></div><div><label for="event-reminder-value" class="block text-sm font-medium text-subtle mb-1">Lembrete</label><div class="relative" data-dropdown-container><input type="hidden" id="event-reminder-value" value="none"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Nenhum</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="event-reminder-list" class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="none" class="selected">Nenhum</li><li data-action="select-dropdown-item" data-value="1d">1 dia antes</li><li data-action="select-dropdown-item" data-value="2d">2 dias antes</li><li data-action="select-dropdown-item" data-value="1w">1 semana antes</li></ul></div></div></div><div><label class="block text-sm font-medium text-subtle mb-1">Cor</label><div id="event-color-palette" class="flex flex-wrap justify-center gap-3 p-2 bg-bkg rounded-md border border-border w-full"></div><input type="hidden" id="event-color-input"></div><div class="mt-8 flex justify-between items-center"><button type="button" id="delete-event-btn" class="text-sm font-semibold text-danger hover:opacity-80">Excluir Evento</button><div class="space-x-4"><button type="button" id="cancel-event-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></div></form></div></div>
  <div id="add-curriculum-subject-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-md border border-border"><h3 class="text-2xl font-bold mb-6 text-secondary">Adicionar Disciplina à Grade</h3><form id="add-curriculum-subject-form" class="space-y-4"><input type="hidden" id="curriculum-subject-id"><div><label for="curriculum-subject-name" class="block text-sm font-medium text-subtle mb-1">Nome da Disciplina*</label><input type="text" id="curriculum-subject-name" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="grid grid-cols-1 sm:grid-cols-2 gap-4"><div><label for="curriculum-subject-code" class="block text-sm font-medium text-subtle mb-1">Código*</label><input type="text" id="curriculum-subject-code" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="curriculum-subject-period" class="block text-sm font-medium text-subtle mb-1">Período Sugerido*</label><input type="number" id="curriculum-subject-period" min="1" placeholder="Ex: 1" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-curriculum-subject-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
  <div id="mark-as-completed-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><h3 id="mark-as-completed-title" class="text-2xl font-bold mb-6 text-secondary">Concluir Disciplina</h3><form id="mark-as-completed-form" class="space-y-4"><input type="hidden" id="completed-subject-id"><div><label for="completed-in-period-value" class="block text-sm font-medium text-subtle mb-1">Período Cursado*</label><div class="relative" data-dropdown-container><input type="hidden" id="completed-in-period-value"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Selecione o período</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="completed-in-period-list" class="custom-dropdown-list"></ul></div></div></div><div><label for="completed-final-grade" class="block text-sm font-medium text-subtle mb-1">Média Final*</label><input type="number" step="0.01" min="0" max="10" id="completed-final-grade" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="relative flex items-start"><div class="flex h-6 items-center"><input id="completed-is-equivalent" type="checkbox" class="h-4 w-4 rounded border-gray-300 text-primary focus:ring-primary"></div><div class="ml-3 text-sm leading-6"><label for="completed-is-equivalent" class="font-medium text-secondary">Cursada por equivalência / dispensa</label></div></div><div id="equivalent-code-container" class="hidden"><label for="completed-equivalent-code" class="block text-sm font-medium text-subtle mb-1">Código da Disciplina Equivalente</label><input type="text" id="completed-equivalent-code" placeholder="Ex: MAT123" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="completed-notes" class="block text-sm font-medium text-subtle mb-1">Observações</label><textarea id="completed-notes" rows="3" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></textarea></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-mark-as-completed-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar Conclusão</button></div></form></div></div>
  <div id="curriculum-subject-details-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><div class="flex justify-between items-start mb-6"><div><h3 id="details-subject-name" class="text-2xl font-bold text-secondary"></h3><p id="details-subject-code" class="text-sm font-mono text-subtle"></p></div><button id="close-curriculum-subject-details-btn" class="p-2 -m-2 rounded-full hover:bg-bkg"><svg class="w-6 h-6 text-subtle" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><div id="details-subject-content" class="space-y-4"></div></div></div>
  <div id="study-history-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-2xl border border-border flex flex-col max-h-[90vh]"><div class="flex justify-between items-center mb-4"><h3 class="text-2xl font-bold text-secondary">Histórico de Sessões de Estudo</h3><button id="close-study-history-modal-btn" class="p-2 -m-2 rounded-full hover:bg-bkg"><svg class="w-6 h-6 text-subtle" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" /></svg></button></div><div id="study-history-list" class="flex-grow overflow-y-auto pr-2 history-scrollbar"><p class="text-subtle text-center">Nenhuma sessão registrada ainda.</p></div></div></div>
  <div id="pomodoro-settings-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-sm border border-border flex flex-col max-h-[90vh]"><h3 class="text-2xl font-bold mb-6 text-secondary flex-shrink-0">Configurar Pomodoro</h3><div class="overflow-y-auto custom-scrollbar -mr-4 pr-4"><form id="pomodoro-settings-form" class="space-y-4"><div><label for="pomodoro-discipline-value" class="block text-sm font-medium text-subtle mb-1">Disciplina (Opcional)</label><div class="relative" data-dropdown-container><input type="hidden" id="pomodoro-discipline-value" name="pomodoro-discipline"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Nenhuma disciplina</span><svg class="w-5 h-5 text-subtle ml-auto" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" /></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="pomodoro-discipline-list" class="custom-dropdown-list"></ul></div></div></div><div><label for="pomodoro-sound-value" class="block text-sm font-medium text-subtle mb-1">Som Ambiente</label><div class="relative" data-dropdown-container><input type="hidden" id="pomodoro-sound-value" name="pomodoro-sound" value="none"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Nenhum</span><svg class="w-5 h-5 text-subtle ml-auto" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9" /></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="pomodoro-sound-list" class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="none">Nenhum</li><li data-action="select-dropdown-item" data-value="light-rain">Chuva Leve</li><li data-action="select-dropdown-item" data-value="storm">Tempestade Distante</li><li data-action="select-dropdown-item" data-value="forest-night">Noite na Floresta</li><li data-action="select-dropdown-item" data-value="waterfall">Cachoeira Suave</li><li data-action="select-dropdown-item" data-value="birds">Pássaros da Manhã</li><li data-action="select-dropdown-item" data-value="lofi">Beats Lo-fi</li><li data-action="select-dropdown-item" data-value="stars">Estrelas Lo-fi</li><li data-action="select-dropdown-item" data-value="milky-way">Via Láctea</li><li data-action="select-dropdown-item" data-value="sunrise">Amanhecer</li><li data-action="select-dropdown-item" data-value="dawn">Madrugada</li></ul></div></div></div><div class="grid grid-cols-2 gap-4"><div><label for="pomodoro-study-time" class="block text-sm font-medium text-subtle mb-1">Foco (min)</label><input type="number" id="pomodoro-study-time" value="25" min="1" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div><label for="pomodoro-break-time" class="block text-sm font-medium text-subtle mb-1">Pausa (min)</label><input type="number" id="pomodoro-break-time" value="5" min="1" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div></div><div class="mt-8 flex justify-end space-x-4 pt-4"><button type="button" id="cancel-pomodoro-settings-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Iniciar</button></div></form></div></div></div>
  <div id="add-document-modal" class="hidden fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50 p-4"><div class="bg-surface p-6 sm:p-8 rounded-lg shadow-xl w-full max-w-lg border border-border"><h3 id="document-modal-title" class="text-2xl font-bold mb-6 text-secondary">Adicionar Documento</h3><form id="add-document-form" class="space-y-4"><input type="hidden" id="document-id"><div><label for="document-file" class="block text-sm font-medium text-subtle mb-1">Arquivo*</label><input type="file" id="document-file" required class="w-full text-sm text-subtle file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-primary/10 file:text-primary hover:file:bg-primary/20"></div><div><label for="document-title" class="block text-sm font-medium text-subtle mb-1">Título*</label><input type="text" id="document-title" placeholder="Ex: Certificado de Horas Complementares" required class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="grid grid-cols-1 md:grid-cols-2 gap-4"><div><label class="block text-sm font-medium text-subtle mb-1">Tipo/Categoria*</label><div class="relative" data-dropdown-container><input type="hidden" id="document-type-value" value="Certificado"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Certificado</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul class="custom-dropdown-list"><li data-action="select-dropdown-item" data-value="Certificado" class="selected">Certificado</li><li data-action="select-dropdown-item" data-value="Comprovante">Comprovante</li><li data-action="select-dropdown-item" data-value="Material de Estudo">Material de Estudo</li><li data-action="select-dropdown-item" data-value="Slide de Aula">Slide de Aula</li><li data-action="select-dropdown-item" data-value="Trabalho Acadêmico">Trabalho Acadêmico</li><li data-action="select-dropdown-item" data-value="Outro">Outro</li></ul></div></div></div><div><label class="block text-sm font-medium text-subtle mb-1">Disciplina Associada</label><div class="relative" data-dropdown-container><input type="hidden" id="document-discipline-value" value="none"><input type="hidden" id="document-period-id-value"><input type="hidden" id="document-enrollment-id-value"><button type="button" data-action="toggle-dropdown" class="custom-dropdown-button"><span class="selected-value truncate">Nenhuma</span><svg class="w-5 h-5 text-subtle ml-auto flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" d="M8.25 15L12 18.75 15.75 15m-7.5-6L12 5.25 15.75 9"></path></svg></button><div data-dropdown-panel class="custom-dropdown-panel hidden"><ul id="modal-discipline-list" class="custom-dropdown-list"></ul></div></div></div></div><div><label for="document-tags" class="block text-sm font-medium text-subtle mb-1">Tags (separadas por vírgula)</label><input type="text" id="document-tags" placeholder="Ex: online, palestra, 2025" class="w-full px-4 py-3 bg-bkg text-secondary border border-border rounded-md"></div><div class="mt-8 flex justify-end space-x-4"><button type="button" id="cancel-document-btn" class="bg-subtle/50 text-secondary font-semibold py-2 px-4 rounded-lg hover:bg-subtle/80">Cancelar</button><button type="submit" class="bg-primary text-bkg font-semibold py-2 px-4 rounded-lg">Salvar</button></div></form></div></div>
`;

export function injectHTML() {
    const appEl = document.querySelector('#app');
    if (appEl) {
        appEl.innerHTML = mainHTML;
        appEl.insertAdjacentHTML('beforeend', modalHTML);
    }
}